FROM node:20-bullseye

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .

# Build-time env for Next.js public runtime
ARG NEXT_PUBLIC_API_BASE_URL=/api
ARG NEXT_BACKEND_URL=http://backend:8000
ARG NEXT_PUBLIC_PICKUP_NAME="Preetizen Lifestyle"
ARG NEXT_PUBLIC_PICKUP_CITY=Kolkata
ARG NEXT_PUBLIC_PICKUP_PIN=700107
ARG NEXT_PUBLIC_PICKUP_COUNTRY=India
ARG NEXT_PUBLIC_HSN_CODE=851770
ARG NEXT_PUBLIC_CONSIGNEE_GST_AMOUNT=150.00
ARG NEXT_PUBLIC_INTEGRATED_GST_AMOUNT=275.50
ARG NEXT_PUBLIC_CONSIGNEE_GST_TIN=27ABCDE1234F1Z5
ARG NEXT_PUBLIC_GST_CESS_AMOUNT=35.25

ENV NEXT_PUBLIC_API_BASE_URL=${NEXT_PUBLIC_API_BASE_URL} \
    NEXT_BACKEND_URL=${NEXT_BACKEND_URL} \
    NEXT_PUBLIC_PICKUP_NAME=${NEXT_PUBLIC_PICKUP_NAME} \
    NEXT_PUBLIC_PICKUP_CITY=${NEXT_PUBLIC_PICKUP_CITY} \
    NEXT_PUBLIC_PICKUP_PIN=${NEXT_PUBLIC_PICKUP_PIN} \
    NEXT_PUBLIC_PICKUP_COUNTRY=${NEXT_PUBLIC_PICKUP_COUNTRY} \
    NEXT_PUBLIC_HSN_CODE=${NEXT_PUBLIC_HSN_CODE} \
    NEXT_PUBLIC_CONSIGNEE_GST_AMOUNT=${NEXT_PUBLIC_CONSIGNEE_GST_AMOUNT} \
    NEXT_PUBLIC_INTEGRATED_GST_AMOUNT=${NEXT_PUBLIC_INTEGRATED_GST_AMOUNT} \
    NEXT_PUBLIC_CONSIGNEE_GST_TIN=${NEXT_PUBLIC_CONSIGNEE_GST_TIN} \
    NEXT_PUBLIC_GST_CESS_AMOUNT=${NEXT_PUBLIC_GST_CESS_AMOUNT}

RUN npm run build

EXPOSE 3000
CMD ["npm", "run", "start", "--", "-p", "3000"]
